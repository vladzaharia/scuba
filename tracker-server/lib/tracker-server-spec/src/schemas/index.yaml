openapi: 3.0.0
info:
  title: Tracker Tracker API
  description: API for tracking Vlad while tracker diving, on https://tracker.vlad.gg
  version: 1.0.0

servers:
  - description: Live
    url: https://tracker.vlad.gg/api
  - description: Local
    url: http://localhost:8787/api

paths:
  /:
    get:
      summary: Server infromation
      description: Provide server information to client
      operationId: serverInfo
      tags:
        - Tracker
      responses:
        200:
          $ref: '#/components/responses/Success'

  /trip:
    get:
      summary: List trips
      description: List all available trips.
      operationId: listTrips
      tags:
        - Tracker
      responses:
        200:
          description: List of trips available.
          content:
            application/json:
              schema:
                type: object
                properties:
                  trips:
                    type: array
                    items:
                      $ref: '#/components/schemas/BasicTrip'
                required:
                  - trips
        500:
          $ref: '#/components/responses/InternalServerError'
  /trip/{trip}:
    get:
      summary: Get trip
      description: Get information about a trip.
      operationId: getTrip
      tags:
        - Tracker
      parameters:
        - $ref: '#/components/parameters/TripName'
      responses:
        200:
          description: Trip information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Trip'
        404:
          $ref: '#/components/responses/TripNotFound'
        500:
          $ref: '#/components/responses/InternalServerError'
  /trip/{trip}/geojson/points:
    get:
      summary: Get points GeoJSON
      description: Get coordinates for a trip as GeoJSON.
      operationId: getTripJSONPoints
      tags:
        - Tracker
      parameters:
        - $ref: '#/components/parameters/TripName'
      responses:
        200:
          description: Trip information
        404:
          $ref: '#/components/responses/TripNotFound'
        500:
          $ref: '#/components/responses/InternalServerError'
  /trip/{trip}/geojson/track:
    get:
      summary: Get track GeoJSON
      description: Get track for a trip as GeoJSON.
      operationId: getTripJSONTrack
      tags:
        - Tracker
      parameters:
        - $ref: '#/components/parameters/TripName'
      responses:
        200:
          description: Trip information
        404:
          $ref: '#/components/responses/TripNotFound'
        500:
          $ref: '#/components/responses/InternalServerError'

components:
  parameters:
    TripName:
      name: trip
      description: Name of trip to use.
      schema:
        $ref: '#/components/schemas/TripName'
      example: mexico
      in: path
      required: true

  responses:
    Success:
      description: Operation executed successfully.
      content:
        application/json:
          schema:
            type: object
            properties:
              message:
                type: string
                description: Success message
                example: ok
            required:
              - message
    InternalServerError:
      description: Something went wrong processing your request.
      content:
        application/json:
          schema:
            type: object
            properties:
              message:
                type: string
                description: Message for this error.
                example: Somethng went wrong!
            required:
              - message
    TripNotFound:
      description: Could not find room.
      content:
        application/json:
          schema:
            type: object
            properties:
              message:
                type: string
                description: Message for this error.
                example: Trip not found!
            required:
              - message

  schemas:
    BasicTrip:
      type: object
      properties:
        name:
          $ref: '#/components/schemas/TripName'
        id:
          $ref: '#/components/schemas/TripId'
      required:
        - name
        - id
    Trip:
      description: Trip information
      type: object
      properties:
        name:
          $ref: '#/components/schemas/TripName'
        id:
          $ref: '#/components/schemas/TripId'
        emoji:
          type: string
          description: Emoji to describe this trip.
          example: üõ£Ô∏è
        type:
          type: string
          description: Type of trip.
          enum:
            - scuba
            - road
        start_date:
          type: string
          description: Start date of this trip.
          format: date-time
          example: 2021-10-04T07:00:00.000Z
        end_date:
          type: string
          description: End date of this trip.
          format: date-time
          example: 2021-10-16T06:59:59.000Z
        time_zone:
          type: string
          description: IANA time zone for this trip.
          example: America/Los_Angeles
        status:
          type: object
          description: Current status based on last known position information.
          properties:
            activity:
              type: string
              description: Best guessed activity based on time, position, and speed.
              enum:
                - diving
                - moving
                - stopped
                - sleeping
                - outdated
                - unknown
            position:
              type: object
              description: Last known position
              properties:
                latitude:
                  type: number
                  description: Latitude of last known position.
                  example: 31.10399
                longitude:
                  type: number
                  description: Longitude of last known position.
                  example: -113.563743
                timestamp:
                  type: string
                  format: date-time
                  description: Timestamp of last known position, in UTC.
                  example: "2021-10-16T06:29:00Z"
                velocity:
                  type: number
                  description: Velocity from last known position, in km/h.
                  example: 12.9
                course:
                  type: number
                  description: Bearing/course from last known position, in degrees.
                  example: 0
              required:
                - latitude
                - longitude
                - timestamp
                - velocity
                - course
          required:
            - activity
            - position
      required:
        - name
        - id
        - emoji
        - type
        - start_date
        - end_date
        - time_zone
        - status
    TripName:
      description: Name of a trip.
      type: string
      example: Mexico
    TripId:
      description: ID of a trip.
      type: string
      example: mexico
